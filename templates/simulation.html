{% extends 'base.html' %}

{% block head %}
<title>Simulation</title>
<script>
    function toggleCliques() {
        var network_structure = document.getElementById("network_structure");
        var n_cliques_container = document.getElementById("n_cliques_container");
        if (network_structure.value == "caveman") {
            n_cliques_container.style.display = "block";
        } else {
            n_cliques_container.style.display = "none";
        }
    }

    function generateAgentsInput() {
        const nAgents = parseInt(document.getElementById("n_agents").value)
        const formAgents = document.getElementById("form-agents")

        formAgents.innerHTML = "<h2>Agents parameters</h2>";

        // Get the prompt options from the Flask template context
        const promptOptions = JSON.parse('{{ prompt_options|tojson }}');

        // Create a table to hold the input fields for all agents
        const agentsTable = document.createElement("table");

        // Create the table header row
        const headerRow = document.createElement("tr");
        const initPromptHeader = document.createElement("th");
        initPromptHeader.textContent = "Initial prompt";
        const updatePromptHeader = document.createElement("th");
        updatePromptHeader.textContent = "Update prompt";
        const personalityHeader = document.createElement("th");
        personalityHeader.textContent = "Personality";
        headerRow.appendChild(initPromptHeader);
        headerRow.appendChild(updatePromptHeader);
        headerRow.appendChild(personalityHeader);
        agentsTable.appendChild(headerRow);

        // Generate table rows for each agent
        for (let i = 0; i < nAgents; i++) {
            const agentRow = document.createElement("tr");

            // Create the select elements for this agent
            const promptInitSelect = document.createElement("select");
            promptInitSelect.id = `prompt_init_${i}`;
            promptInitSelect.name = `prompt_init_${i}`;
            promptInitSelect.className = "agent-select"; // Add a class name to the select element
            const promptUpdateSelect = document.createElement("select");
            promptUpdateSelect.id = `prompt_update_${i}`;
            promptUpdateSelect.name = `prompt_update_${i}`;
            promptUpdateSelect.className = "agent-select"; // Add a class name to the select element
            const personalitySelect = document.createElement("select");
            personalitySelect.id = `personality_list_${i}`;
            personalitySelect.name = `personality_list_${i}`;
            personalitySelect.className = "agent-select"; // Add a class name to the select element

            // Populate the options for each select element using the prompt options
            for (const option of promptOptions.initial_prompts) {
                const promptInitOption = document.createElement("option");
                promptInitOption.value = option;
                promptInitOption.textContent = option;
                promptInitSelect.appendChild(promptInitOption);
            }

            for (const option of promptOptions.update_prompts) {
                const promptUpdateOption = document.createElement("option");
                promptUpdateOption.value = option;
                promptUpdateOption.textContent = option;
                promptUpdateSelect.appendChild(promptUpdateOption);
            }

            for (const option of promptOptions.personalities) {
                const personalityOption = document.createElement("option");
                personalityOption.value = option;
                personalityOption.textContent = option;
                personalitySelect.appendChild(personalityOption);
            }

            // Add the select elements to the agent row
            const initPromptCell = document.createElement("td");
            initPromptCell.appendChild(promptInitSelect);
            const updatePromptCell = document.createElement("td");
            updatePromptCell.appendChild(promptUpdateSelect);
            const personalityCell = document.createElement("td");
            personalityCell.appendChild(personalitySelect);
            agentRow.appendChild(initPromptCell);
            agentRow.appendChild(updatePromptCell);
            agentRow.appendChild(personalityCell);

            // Add the agent row to the table
            agentsTable.appendChild(agentRow);
        }

        // Add the table to the form-agents div
        formAgents.appendChild(agentsTable);
    }



    window.onload = function() {
        generateAgentsInput();
};
</script>


{% endblock %}

{% block body %}

<h1>Run a transmission simulation</h1>

<form method="POST">
    <h2>Experiment parameters</h2>

    <div class="form-column">
        <label for="output">Experiment name:</label>
        <input type="text" id="name" name="name" value=""><br>

        <label for="n_agents">Number of agents:</label>
        <input type="number" id="n_agents" name="n_agents" min="1" value="2" oninput="generateAgentsInput()"><br>

        
    </div>

    <div class="form-column">
        <label for="n_timesteps">Number of generations:</label>
        <input type="number" id="n_timesteps" name="n_timesteps" min="1" value="10"><br>

        <label for="network_structure">Network structure:</label>
        <select id="network_structure" name="network_structure" onchange="toggleCliques()">
            <option value="sequence">Sequence</option>
            <option value="fully_connected">Fully connected</option>
            <option value="circle">Circle</option>
            <option value="caveman">Caveman</option>
        </select><br>

    </div>

    <div id="n_cliques_container" style="display: none;">
        <label for="n_cliques">Number of cliques in caveman network:</label>
        <input type="number" id="n_cliques" name="n_cliques" min="1" value="2"><br>
    </div>


    <div class="form-agents" id="form-agents">
        <h2>Agents parameters</h2>
    </div> 

      <div class="form-button">
        <input type="submit" value="Run simulation">
      </div> 

</form>

{% endblock %}

